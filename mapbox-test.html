<!DOCTYPE html>
<html>
  <head>
    <title>Mapbox for Asurion</title>

    <script src="https://use.fontawesome.com/3f1ebc53a0.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.0/mapbox-gl.css' rel='stylesheet' />

    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.0.2/mapbox-gl-directions.js'></script>
  <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.0.2/mapbox-gl-directions.css' type='text/css' />

    <link rel="stylesheet" type="text/css" href="map-styles.css">

    
  </head>

  <body>

    
    <div id='map' style='width: 800px; height: 600px;'></div>
    <div class="map-controls">
      <div class="map-button-container">
        <input type="radio" name="modeSwitch" value="darkMode" id="darkModeButton" class="styleSwitchButton" onclick = "darkStyle(this)">
        <label for="darkModeButton">Dark Mode
          <div class="customButton">
            <div class="interiorButton"></div>
          </div>
        </label>
      </div>
      <div class="map-button-container selected">
        <input type="radio" name="modeSwitch" value="lightMode" id="lightModeButton" class="styleSwitchButton" onclick = "lightStyle(this)">
        <label for="lightModeButton">Light Mode
          <div class="customButton">
            <div class="interiorButton"></div>
          </div>
        </label>
      </div>
      <br>
      <div class="map-button-container">
        <div class="flyToButton" onClick = "flyToCoord()">Zoom In Sterling</div>
      </div>
      <div class="map-button-container">
        <div class="flyToButton" onClick = "flyToCoordWithZoom()">Zoom Out Nashville</div>
      </div>
      <br>
      <div class="map-button-container">
        <div class="directions" onClick = "getRoute()">Directions</div>
      </div>  
    </div>  

    <script>
      mapboxgl.accessToken = 'pk.eyJ1IjoibWFkY2FybW9keSIsImEiOiJjazE4MGJvY2IwYmV5M3BwaWNoaTVreGlsIn0.dHVhh-U4SQgDxUB0ShAWbg';
      lightMapStyle = 'mapbox://styles/madcarmody/ck180lo7s012v1co308wz9u1m';
      darkMapStyle = 'mapbox://styles/madcarmody/ck181zpvs02bo1cphsdgdzik7';

      var map = new mapboxgl.Map({
          container: 'map',
          style: lightMapStyle
      });

      // initialize the map canvas to interact with later
      var canvas = map.getCanvasContainer();

      var start = [-86.773, 36.158];
      var end = [-77.435, 38.981];

      // create a function to make a directions request
      function getRoute() {
        // make a directions request using cycling profile
        // an arbitrary start will always be the same
        // only the end or destination will change
        end = [-77.435, 38.981];
        start = [-86.782, 36.163];
        var url = 'https://api.mapbox.com/directions/v5/mapbox/driving/' + start[0] + ',' + start[1] + ';' + end[0] + ',' + end[1] + '?steps=true&geometries=geojson&access_token=' + mapboxgl.accessToken;

        // make an XHR request https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest
        var req = new XMLHttpRequest();
        req.responseType = 'json';
        req.open('GET', url, true);
        req.onload = function() {
          var data = req.response.routes[0];
          var route = data.geometry.coordinates;
          var geojson = {
            type: 'Feature',
            properties: {},
            geometry: {
              type: 'LineString',
              coordinates: route
            }
          };
          // if the route already exists on the map, reset it using setData
          if (map.getSource('route')) {
            map.getSource('route').setData(geojson);
          } else { // otherwise, make a new request
            map.addLayer({
              id: 'route',
              type: 'line',
              source: {
                type: 'geojson',
                data: {
                  type: 'Feature',
                  properties: {},
                  geometry: {
                    type: 'LineString',
                    coordinates: geojson
                  }
                }
              },
              layout: {
                'line-join': 'round',
                'line-cap': 'round'
              },
              paint: {
                'line-color': '#3887be',
                'line-width': 5,
                'line-opacity': 0.75
              }
            });
          }
          // add turn instructions here at the end
        };
        req.send();
      }

      map.on('load', function() {
        // make an initial directions request that
        // starts and ends at the same location
        getRoute(start);

        // Add starting point to the map
        map.addLayer({
          id: 'point',
          type: 'circle',
          source: {
            type: 'geojson',
            data: {
              type: 'FeatureCollection',
              features: [{
                type: 'Feature',
                properties: {},
                geometry: {
                  type: 'Point',
                  coordinates: start
                }
              }
              ]
            }
          },
          paint: {
            'circle-radius': 10,
            'circle-color': '#3887be'
          }
        });
        // this is where the code from the next step will go
      });


      function lightStyle(self) {
        map.setStyle(lightMapStyle);
        self.parentElement.classList.add("selected");
        document.getElementById("darkModeButton").parentElement.classList.remove("selected");
      }

      function darkStyle(self) {
        map.setStyle(darkMapStyle);
        self.parentElement.classList.toggle("selected");
        document.getElementById("lightModeButton").parentElement.classList.remove("selected");
      }

      function flyToCoord() {
        map.flyTo({
          center: [
            -77.435,
            38.981
          ],
          zoom: 10
        })
      }

      function flyToCoordWithZoom() {
        map.flyTo({
          center: [
            -86.782,
            36.163
          ],
          zoom: 7
        })
      }
    </script>


  </body>
</html>